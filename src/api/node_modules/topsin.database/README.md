[TOC]

# database - 数据库连接
`database` 主要用于管理数据库连接对象;

##方法

### addConnection(iCntParam, [iCntName])
添加数据库连接

**参数**
- **iCntParam** `Map<string,any>` : 数据库连接参数，结构如下

|  键 | 类型  |  必选 |  默认值 | 说明  |举例|
| :------------ | :------------ | :------------ | :------------ | :------------ |:------------|
|  database_type |  string | 是  |   | 数据库类型,当前支持`pg`,`mysql`,`oracle`,`mssql`,`sqlite`  |pg|
|  database_host |  string | 是  |   | 数据库主机地地及端口  |127.0.0.1:5432|
|  database_name |  string | 是  |   | 数据库名称,当前type为sqlite时指文件路径  |TOPMES_DEMO_V6|
|  database_user |  string |   |   | 数据库登录名  |  |
|  database_pwd |  string |   |   | 数据库登录密码  | |
|  database_encrypt |  string |   |空   | 数据库密码加密方式,当前支持`EB642`  |   |
|  database_options |  string |   |   | 其它连接选项  |   |
|  auto_close_timeout |  int |   |120000| 超时多少毫秒连接自动关闭  | .  |





- **iCntName** `string`: 连接名称

**返回**

**示例**
```js
var db = require('database');
db.addConnection({
        database_type:'pg',
    database_host:'127.0.0.1:5432',
    database_name:'TOPMES_SNAPSHOT_V6',
    database_user:'toplinker',
    database_pwd:'Password'
}, "MES_DB");
```
------
### removeConnection(iCntName)
移除数据库连接

**参数**

- **iCntName** `string`: 连接名称

**返回**

**示例**
```js
var db = require('database');
db.removeConnection('MES_DB');
```
------
### query([iCntName])
获取一个[SqlQuery](/docs/topjs_api/topjs-api-sqlquery)的数据库操作对象;
由于此方式获取出的[SqlQuery](/docs/topjs_api/topjs-api-sqlquery)需手动进行关闭和销毁,因此一般采用`query(iCntName,iCallback)`回调的方式；

**参数**

- **\[iCntName]** `string`: 连接名称; 默认为空

**返回**

**示例**
```js
var db = require('database');
db.addConnection({
    database_type:'pg',
    database_host:'127.0.0.1:5432',
    database_name:'TOPMES_SNAPSHOT_V6',
    database_user:'toplinker',
    database_pwd:'Password'
}, "MES_DB");
var query = db.query('MES_DB');

```
------
### query(iCntName, iCallback)
获取一个[SqlQuery](/docs/topjs_api/topjs-api-sqlquery)的数据库操作对象; 并执行回调函数; 回调函数执行完成后,会自动销毁[SqlQuery](/docs/topjs_api/topjs-api-sqlquery)对象；

**参数**

- **iCntName** `string`: 连接名称; 默认为空
- **iCallback** `(query:SqlQuery) => any`: 回调函数

**返回**

**示例**
```js
var db = require('database');
db.addConnection({
    databse_type:'pg',
    database_host:'127.0.0.1:5432',
    database_name:'TOPMES_SNAPSHOT_V6',
    database_user:'toplinker',
    database_pwd:'Password'
}, "MES_DB");

var result = db.query("MES_DB", function(query) {
    return query.selectMap({
        table:'sys_user',
        field: '*',
        field_format:{"tags":'array', attr_data:'json'}
    });
});

```
