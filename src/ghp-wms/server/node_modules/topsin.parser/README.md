[TOC]

# topsin.parser - 数据解析
`topsin.parser` 提供了一系列快捷数据解析及转换函数,如解析`ini`,`csv`,`xml`文件等。

##方法

### parseIniFile(iFile)
读取并解析Ini文件，转换为Map结构;

**参数**
- **iFile** `string` : Ini文件路径

**返回**
- `Map<string,string>`:返回解析后的Map结构

**示例**

```javascript
var parser = require('topsin.parser');
var ini_map = parser.parseIniFile('c:/tmp/test.ini');
```
> c:/tmp/test.ini内容如下
```ini
[DATA]
JobName = 334455
ReturnFile = 334455.dxf
StatusFile = 334455.sta
Direction = CNC
Jobmode = PP
RemoveOverlapping = 0
```
> 解析后的输出结果为
```json
{
	"DATA/JobName" : "334455",
	"DATA/ReturnFile" : "334455.dxf",
	"DATA/StatusFile" : "334455.sta",
	"DATA/Direction" : "CNC",
	"DATA/Jobmode" : "PP",
	"DATA/RemoveOverlapping" : "0"
}
```
------

### parseCsvStr(iStr, [oErr])
解析CSV字符串,变为数组格式；

**参数**
- **iStr** `string` : Ini格式字符
- **\[oErr]** [`ErrMsg`](http://doc.topibd.net/docs/topjs_api/topjs-api-errmsg "ErrMsg") : 保存错误信息的变量引用

**返回**
`Array<Array<string>>` 返回解析后的数组

**示例**

```javascript
var parser = require('topsin.parser');
var csv_str = "C11,C12,C13,C14\nC21,C22,C23,C24";
var csv_data = parser.parseCsvStr(csv_str, err);
print(_.toString(csv_data));
//=>[["C11","C12","C13","C14"],["C21","C22","C23","C24"]
```
------------

### strList2Csv(iStrList)
将字符串列表转为CSV格式;

**参数**
- **iStrList** `Array<string>` 字符串列表

**返回**
- `string` CSV字符串;

**示例**

```javascript
var parser = require('topsin.parser');
var csv = parser.strList2Csv(['a','b','c,1','d"b']);
//=>a,b,"c,1","d\"b"
```
------------

### parseXmlStr(iXmlStr, [iArrayFlags], [iRootFlag], [iTextDomFlag], [iOptions])
解析XML字符串;
- 在进行XML转换时, 默认情况下如果一个节点中只有一组数据，会将此节点转为Map结构，有多组数据时，会转为Array结构；为了保证数据的结构的统一性，可以将设置`iArrayFlags`参数；此时包含在`iArrayFlags`中的节点不管是一组还是多组数据，都会强制转为Array结构;
- 如果数据节点层级太多,则可以通过设置`iRootFlag`来设置返回数据的根节点;
- 对于`<xml arrt1=abc>Text</xml>`格式的节点,可通过`iTextDomFlag`来设置`Text`所对应的key; 该key默认为`_DOM_TEXT_`

**参数**
- **iXmlStr** `string` XML字符串
- **\[iArrayFlags]** `Array<string>` 需强制转为数组的标签; 默为空
- **\[iRootFlag]** `string` 根节点名称; 默认为空
- **\[iTextDomFlag]** `string` 存放节点Text数据的key; 默认为`_DOM_TEXT_`
- **\[iOptions]** `Map<string,any>` 其它控制选项，暂时无效

**返回**
- `Array<any>`|`Map<string,any>` 返回解析后的数据

**示例**

------------

### capDollarVar(iStr)
捕捉字符串中的${somekey}型式的变量;;

**参数**
- **iStr** `string` 原始字符串

**返回**
- `Array<string>` 返回捕捉的变量列表;

**示例**

```javascript
var parser = require('topsin.parser');
var varlist = parser.capDollarVar('my name is ${name}, i am ${age} years old.');
//=>["name", "age"]
```
------------
### replaceDollarVar(iStr,iValues)
替换字符串中的${somekey}变量;

**参数**
- **iStr** `string` 原始字符串
- **iValues** `Map<string,string>` 替换值

**返回**
`string` 返回替换后的字符串

**示例**

```javascript
var parser = require('topsin.parser');
var replated_str = parser.replaceDollarVar('my name is ${name}, i am ${age} years old.',{name:'tony', age:21});
//=>my name is tony, i am 21 years old.
```
------------

### encodeBase64(iStr)
将字符串转为base64;

**参数**
- **iStr** `string` 原始字符串

**返回**
- `string` 返回base64字符串

**示例**

```javascript
var parser = require('topsin.parser');
var str = 'i am tony';
var base64 = parser.encodeBase64(str);
//=>aSBhbSB0b255
```
------------

### decodeBase64(iStr)
将base64格式转为字符串

**参数**
- **iStr** `string` base64格式字符串

**返回**
- `string` 返回正常字符串

**示例**

```javascript
var parser = require('topsin.parser');
var base64 = 'aSBhbSB0b255';
var str = parser.decodeBase64(base64);
//=>i am tony
```
------------

### escapeXml(iStr)
 对一个字符串做XML格式的字符转义;

**参数**
- **iStr** `string` 原始字符串

**返回**
- `string` 返回转义后的字符串

**示例**

------------

## 版本履历
#### V1.1.0 2019-03-22
. 兼容TopJS3.1.0;

#### V1.0.1 2019-02-28
. 代码重构;

#### V1.0.0 2018-10-18
. 初次发布;
