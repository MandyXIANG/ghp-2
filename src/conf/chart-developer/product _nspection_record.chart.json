{
  "class": "",
  "graph_data": [
    {
      "datasource": {
        "class": "",
        "data": "function func(rawData, uiLoader) {\n  importPackage('moment')\n  var inData = JSON.parse(rawData)\n\n\n  var startDate = inData.startdate + ' 00:00:00'\n  var endDate = inData.enddate + ' 23:59:59'\n  var Process_code = inData.process_code\n\n\n  var db = new TSqlQueryV2(T_SQLCNT_POOL.getSqlDatabase())\n\n\n  try {\n    var where = [\n      \"qc.qc_start_time  BETWEEN '\" + startDate + \"' AND '\" + endDate + \"'\",\n      \"(qc.attr_data ->>'spot_test_flag') ISNULL\",\n      \"class='iqs_form'\",\n    ]\n    if (Process_code != '') {\n      where.push(\"qc.process_code  ='\" + Process_code + \"'\")\n    }\n\n\n    var finishedPlanLst = db.selectArrayMap({\n      table:\n        'mes_prod_iqs qc ' +\n        \"LEFT JOIN mes_prod_order ORD01 ON ORD01. ID :: VARCHAR = qc.attr_data ->> 'prod_order_id' \" +\n        \"LEFT JOIN mes_material_attr_value t0 ON t0.partnumber = ORD01.partnumber and t0.attr_class = 'ghp_product_info' and t0.attr_name ='pn_area' \",\n      field: [\n        'qc.partnumber', //料号\n        'ORD01.prod_order_no as uname', //生产任务号---\n        'qc.qc_workshift ', // 检验人员\n        'qc.qc_start_time ', //开始时间\n        'qc.qc_end_time ', //结束时间\n        \"qc.prod_json_data  ->> 'est_inspect_qty' as\" +\n          '\"prod_json_data.est_inspect_qty\"', //抽样预估数量\n        \"qc.prod_json_data  ->> 'scrap_qty' as\" + '\"prod_json_data.scrap_qty\"', // 不合格数量\n        \"qc.prod_json_data  ->> 'output_qty' as\" +\n          '\"prod_json_data.output_qty\"', //合格总数\n        \"qc.prod_json_data  ->> 'confirm' as\" + '\"prod_json_data.confirm\"', // 确认人员\n        'qc.result_json_data', //不良信息\n        \"ORD01.attr_data ->> 'product_line' as\" + '\"attr_data.product_line\"', //产品生产线---\n        't0.value as pn_area', //表面积\n      ],\n      where: where,\n      order: 'qc.ID DESC',\n    })\n\n\n    var table = getTableViewStructure(startDate, endDate)\n    uiLoader.getObject('table').setHeaderItem(table.header_items)\n    uiLoader.getObject('table').setDataKeyList(table.data_keys)\n    return JSON.stringify({\n      table: finishedPlanLst,\n    })\n  } catch (e) {\n    TLogger.writeLog('error::' + _.toString(e))\n  }\n\n\n  function getTableViewStructure() {\n    var table = {\n      header_items: [\n        {\n          name: 'partnumber',\n          display: '物料编码',\n          displayRole: '$partnumber',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'uname',\n          display: '生产任务号',\n          displayRole: '$uname',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'lot_no',\n          display: '批次',\n          displayRole: '$lot_no',\n          resizeMode: 'ResizeToContents',\n        },\n        /* \n        ----- 无\n        {\n          name: '',\n          display: '图号',\n          displayRole: '$',\n          resizeMode: 'ResizeToContents',\n        }, */\n        /* {\n          name: 'attr_data.category',\n          display: '大分类',\n          displayRole: '$attr_data.category',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'attr_data.group_name',\n          display: '小分类',\n          displayRole: '$attr_data.group_name',\n          resizeMode: 'ResizeToContents',\n        }, */\n        {\n          name: 'qc_start_time',\n          display: '开始时间',\n          displayRole: '$qc_start_time',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'qc_end_time',\n          display: '结束时间',\n          displayRole: '$qc_end_time',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'prod_json_data.est_inspect_qty',\n          display: '抽样预估数量',\n          displayRole: '$prod_json_data.est_inspect_qty',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'prod_json_data.output_qty',\n          display: '合格量',\n          displayRole: '$prod_json_data.output_qty',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'prod_json_data.scrap_qty',\n          display: '不合格量',\n          displayRole: '$prod_json_data.scrap_qty',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'prod_json_data.confirm',\n          display: '确认人员',\n          displayRole: '$prod_json_data.confirm',\n          resizeMode: 'ResizeToContents',\n        },\n        /*         {\n          name: '',\n          display: '备注',\n          displayRole: '$',\n          resizeMode: 'ResizeToContents',\n        }, */\n        {\n          name: 'qc_workshift',\n          display: '检验人员',\n          displayRole: '$qc_workshift',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'attr_data.product_line',\n          display: '产品生产线',\n          displayRole: '$attr_data.product_line',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'pn_area',\n          display: '表面积',\n          displayRole: '$pn_area',\n          resizeMode: 'ResizeToContents',\n        },\n        /* \n        ------无\n        {\n          name: 'attr_data.pn_material',\n          display: '产品材质',\n          displayRole: '$attr_data.pn_material',\n          resizeMode: 'ResizeToContents',\n        },\n        {\n          name: 'attr_data.pn_costomer',\n          display: '客户信息',\n          displayRole: '$attr_data.pn_costomer',\n          resizeMode: 'ResizeToContents',\n        }, */\n        /* {\n          name: 'remark',\n          display: '备注',\n          displayRole: '$remark',\n          resizeMode: 'ResizeToContents',\n        }, */\n        /*  {\n          name: 'result_json_data',\n          display: '不良',\n          displayRole: '$result_json_data',\n          resizeMode: 'ResizeToContents',\n          backgroundRole: 'yellow',\n        }, */\n      ],\n      data_keys: [\n        'partnumber',\n        'uname',\n        'lot_no',\n        'qc_start_time',\n        'qc_end_time',\n        'prod_json_data.est_inspect_qty',\n        'prod_json_data.output_qty',\n        'prod_json_data.scrap_qty',\n        'prod_json_data.confirm',\n        'qc_workshift',\n        'attr_data.product_line',\n        'pn_area',\n        'result_json_data',\n      ],\n    }\n\n\n    return table\n  }\n}\n\n",
        "name": "product_nspection_record",
        "parameter": "startdate,enddate,process_code",
        "remark": "检验线个人检验记录"
      },
      "graph": {
        "class": "",
        "data": "[\n    {\n        name: 'info',\n        type: 'VBoxLayout',\n        property: { spacing: 0, margin: 0 },\n        child: [\n            {\n                name: 'table',\n                type: 'TreeView',\n                property: {},\n                pack: {},\n                initCallback: function (obj) {\n                },\n                setter: function (obj, value, self) {\n                  if (value != null) {\n                      obj.loadTreeData(value);\n                  } else {\n                    obj.loadTreeData([]);\n                  }\n              }\n            }\n        ]\n    }\n]\n\n\n",
        "dynamic": 1,
        "name": "product_nspection_record",
        "parameter_remark": "",
        "remark": "检验线个人检验记录"
      }
    }
  ],
  "graph_layout": {
    "child": [
      {
        "name": "product_nspection_record",
        "pack": {
          "columnSpan": 1,
          "fromColumn": 0,
          "fromRow": 0,
          "rowSpan": 2
        },
        "type": "uiloader"
      }
    ],
    "type": "gridlayout"
  },
  "name": "product _nspection_record",
  "parameter_list": "function func(self) {\n  importPackage('moment')\n  return [\n    {\n      name: 'widget',\n      type: 'Widget',\n      property: {},\n      child: [\n        {\n          name: 'scrollarea',\n          type: 'ScrollArea',\n          property: { widget_resizable: true, frame_shape: 'QFrame::NoFrame' },\n          pack: {},\n          child: {\n            name: 'gridlayout',\n            type: 'GridLayout',\n            property: {},\n            pack: {},\n            child: [\n              // 开始时间\n              {\n                name: 'startdatelbl',\n                type: 'Label',\n                property: {\n                  text: '开始时间',\n                  alignment: 'Qt::AlignLeft',\n                  size_policy: 'Fixed,Fixed',\n                },\n                pack: { row: 0, column: 0 },\n              },\n              {\n                name: 'startdate',\n                type: 'DateEdit',\n                title: self.ttr('Start Date'),\n                pack: { row: 0, column: 1 },\n                initCallback: function (obj, self) {\n                  obj.setData(\n                    'value',\n                    moment(moment().startOf('month')).format('YYYY-MM-DD')\n                  )\n                },\n                validate: function (obj, val, title, moments, self) {\n                  var endDateStr = this.getValue('enddate')\n                  endDateStr = String(endDateStr).replace(/-/g, '/')\n                  val = String(val).replace(/-/g, '/')\n                  var endDate = new Date(endDateStr)\n                  var startDate = new Date(val)\n                  if (val.trim() == '') {\n                    return [title + self.ttr(' can not be null!'), 'Error']\n                  } else if (startDate > endDate) {\n                    return [\n                      self.ttr('Start date can not be later than end date!'),\n                      'Error',\n                    ]\n                  }\n                },\n              },\n\n\n              // 结束时间\n              {\n                name: 'endtdatelbl',\n                type: 'Label',\n                property: {\n                  text: '结束时间',\n                  alignment: 'Qt::AlignLeft',\n                  size_policy: 'Fixed,Fixed',\n                },\n                pack: { row: 0, column: 2 },\n              },\n              {\n                name: 'enddate',\n                type: 'DateEdit',\n                title: self.ttr('End Date'),\n                pack: { row: 0, column: 3 },\n                validate: 'NOTNULL',\n                initCallback: function (obj, self) {\n                  obj.setData('value', APP.getToday())\n                },\n              },\n\n\n              // 检验工序\n              {\n                name: 'Process_code',\n                type: 'Label',\n                property: {\n                  text: '检验工序',\n                  alignment: 'Qt::AlignLeft',\n                  size_policy: 'Fixed,Fixed',\n                },\n                pack: { row: 0, column: 4 },\n              },\n              {\n                name: 'process_code',\n                type: 'ComboBox',\n                title: self.ttr('Process_code'),\n                property: {\n                  item_list: [\n                    { name: 'GF014_GF003', text: '清洗' },\n                    { name: 'GF014_GF006,GF014_GF005', text: '钝化' },\n                  ],\n                  minimum_width: 260,\n                },\n                pack: { row: 0, column: 5 },\n              },\n            ],\n          },\n        },\n      ],\n    },\n  ]\n}\n\n",
  "remark": "检验线个人检验记录"
}